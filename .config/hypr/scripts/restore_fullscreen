#!/usr/bin/env nix-shell
#! nix-shell -i bash -p jq socat

handle() {
  case $1 in 
    fullscreen* | workspace*)
      fullscreen=$(hyprctl -j activewindow | jq -r '.fullscreen')
      fullscreenmode=$(hyprctl -j activewindow | jq -r '.fullscreenMode')
    ;;
    closewindow*)
      if [ "$fullscreen" = true ] && [ "$fullscreenmode" -eq 0 ]; then
        hyprctl dispatch fullscreen 0
      elif [ "$fullscreen" = true ] && [ "$fullscreenmode" -eq 1 ]; then
        hyprctl dispatch fullscreen 1
      fi
    ;;
  esac
}

socat -U - UNIX-CONNECT:$XDG_RUNTIME_DIR/hypr/$HYPRLAND_INSTANCE_SIGNATURE/.socket2.sock | while read -r line; do handle "$line"; done
